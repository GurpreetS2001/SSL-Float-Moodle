{% extends 'mainpage.html' %}

{% block title %} {{ course.code }}: {{ course.name }} {% endblock %}

{% block content %}
{% if user.is_authenticated and user == request.user %}
<div id="main">
  {% if relation.is_student %}
  <div style="float:right; width:15%; padding:30px;" >
  <a href="{% url 'student_course_stats' name=course.name %}"> <button class="btn btn-primary active">Check Course Grades</button></a>
  </div>
  {% endif %}
  {% if not relation.is_student %}
  <div style="float:right; width:15%; padding:30px;" >
  <a href="{% url 'teacher_course_stats' name=course.name %}"> <button class="btn btn-primary active">Check Course Stats</button></a>
  </div>
  {% endif %}
<h1>{{course.name}}</h1>

<h3>{{course.code}}</h3>
<hr>

<h4><a href="{% url 'course_members' name=course.name %}">View course members</a></h4>  <!--dhvanit-->

<hr>
<h4>
  <a href="{% url 'course_forum' name=course.name %}">Discussion Forum</a>
  {% if relation.is_teacher %}
    {% if course.forums_enabled %}<a href="{% url 'disable_forum' name=course.name %}">(Disable)</a>
    {% else %}<a href="{% url 'enable_forum' name=course.name %}">(Enable)</a>
    {% endif %}
  {% endif %}
</h4>  <!--dhvanit-->

<hr>  <!--dhvanit-->


{% if privileges.can_create_assignments %} 
<h4><a href="{% url 'add_assign' name=course.name %}">Create Assignment</a></h4>
<hr>
{% endif %}


{% if privileges.can_create_lectures %} <!--dhvanit-->
<div style="width: 90rem; margin: auto; border: 3px solid gray;">
    <div class="card-body">
        <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <h3><b>Upload new lecture</b></h3>
        {{ form.as_p }}
        <input class="btn btn-primary active" type="submit" value="Upload" name="Upload">
        </form>
    </div>
</div>
<hr>
{% endif %}

<h3>Assignments:</h3>
{% for assignment in assignments %}
    <hr>
    <div>
      <h4>{{assignment.0.assignment_name}}</h4>
      <h5>{{assignment.0.prob_description}}</h5>
      <h5>Due by {{assignment.0.deadline}}</h5>
       <!-- <a href="{{ assignment.problemfile.url }}" download>Download problem statement</a><br> -->
      <a href="{% url 'view_assign' name=course.name id=assignment.0.pk %}">View Assignment Status</a>
    </div>
    {% if relation.is_student %}
      {% if assignment.1 %}
      <div class="alert alert-success" role="alert" style="width:10%;">
        <h4 class="glyphicon glyphicon-check" aria-hidden="true"></h4> Submitted!
    </div>
    {% else %}
    <div class="alert alert-warning" role="alert" style="width:10%;">
      <h4 class="glyphicon glyphicon-info-sign" aria-hidden="true"></h4> Not Submitted!
  </div>

      {% endif %}
    {% endif %}

{% endfor %}
<hr>

<h3>Lectures:</h3>

{% if relation.is_student %}
{% for lecture in lectures %}
    <hr>
    <div>
      <h4>{{lecture.0.title}}</h4>
      <p>{{lecture.0.description}}</p>
      <a href="{{ lecture.0.lecturenotes.file.url }}" download>Lecture Notes</a>
      <br>
      <br>
      {% if lecture.1 %}
      <form method="post" action="{% url 'course_page' name=course.name lecture_num=lecture.0.pk%}">
        {% csrf_token %}
        <button type="submit" name="lec_completed" value="Press to Undo" class="btn btn-danger">
          <span class="fa fa-undo" aria-hidden="true"></span> Undo
        </button>
      </form>
      {% else %}
      <form method="post" action="{% url 'course_page' name=course.name lecture_num=lecture.0.pk%}">
        {% csrf_token %}
        <button type="submit" name="lec_incomplete" value="Lecture Done" class="btn btn-success">
        <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Mark as Done
        </button>
      </form>
      {% endif %}
    </div>
  
{% endfor %}
{% endif %}

{% if  not relation.is_student %}
{% for lecture in lectures %}
    <hr>
    <div>
      <h4>{{lecture.0.title}}</h4>
      <p>{{lecture.0.description}}</p>
      <a href="{{ lecture.0.lecturenotes.file.url }}" download>Lecture Notes</a>
      </form>
    </div>
  
{% endfor %}
{% endif %}
</div>
{% else %}
<div class="alert alert-danger" role="alert" style="margin-left: 20%; margin-top: 20px;">
    Invalid Access Attempt!
  </div>
{% endif %}
{% endblock %}